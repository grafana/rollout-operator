groups:
    - name: rollout_operator_alerts
      rules:
        - alert: rollout-operatorIncorrectWebhookConfigurationFailurePolicy
          annotations:
            message: |
                A validating or mutating rollout-operator webhook has an Ignore policy set. This should be set to Fail.
            runbook_url: https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#rollout-operatorincorrectwebhookconfigurationfailurepolicy
          expr: |
            count by(type, webhook) (kube_validating_webhook_failure_policy{policy="Ignore", webhook=~"^(pod-eviction|zpdb-validation).null.grafana.com"} > 0)
          for: 1h
          labels:
            severity: warning
        - alert: rollout-operatorBadZoneAwarePodDisruptionBudgetConfiguration
          annotations:
            message: An invalid zone aware pod disruption budget configuration has been observed.
            runbook_url: https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#rollout-operatorbadzoneawarepoddisruptionbudgetconfiguration
          expr: sum by (job)(rate(rollout_operator_zpdb_configurations_observed_total{result="invalid"}[5m])) > 0
          for: 5m
          labels:
            severity: warning
        - alert: rollout-operatorHighNumberInflightZpdbRequests
          annotations:
            message: A sustained number of in-flight zpdb eviction requests has been observed.
            runbook_url: https://grafana.com/docs/mimir/latest/operators-guide/mimir-runbooks/#rollout-operatorhighnumberinflightzpdbrequests
          expr: avg_over_time(rollout_operator_zpdb_inflight_eviction_requests[5m]) > 10
          for: 5m
          labels:
            severity: warning
